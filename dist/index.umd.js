!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).AppExtensionsSdk=n()}(this,(function(){"use strict";function e(e,n,i,t){return new(i||(i=Promise))((function(o,s){function r(e){try{d(t.next(e))}catch(e){s(e)}}function a(e){try{d(t.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}d((t=t.apply(e,n||[])).next())}))}var n,i,t,o,s,r,a;!function(e){e.SHOW_SNACKBAR="show_snackbar",e.SHOW_CONFIRMATION="show_confirmation",e.RESIZE="resize",e.INITIALIZE="initialize",e.OPEN_MODAL="open_modal",e.CLOSE_MODAL="close_modal",e.GET_SIGNED_TOKEN="get_signed_token"}(n||(n={})),function(e){e.VISIBILITY="visibility",e.CLOSE_CUSTOM_MODAL="close_custom_modal"}(i||(i={})),function(e){e.COMMAND="command",e.LISTENER="listener",e.TRACK="track"}(t||(t={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.NEGATIVE="negative"}(o||(o={})),function(e){e.DEAL="deal",e.ORGANIZATION="organization",e.PERSON="person",e.JSON_MODAL="json_modal",e.CUSTOM_MODAL="custom_modal"}(s||(s={})),function(e){e.CLOSED="closed",e.SUBMITTED="submitted"}(r||(r={})),function(e){e.FOCUSED="focused"}(a||(a={}));const d=Object.values(n),c=Object.values(i);return Object.assign(class{constructor(e={}){const{identifier:n,targetWindow:i}=e;if(this.initialized=!1,this.window=null!=i?i:window.parent,this.identifier=null!=n?n:new URLSearchParams(window.location.search).get("id"),!this.identifier)throw new Error("Missing custom UI identifier");!function(e){let n=!1;null===window||void 0===window||window.addEventListener("focus",(()=>{n||e(),n=!0})),null===window||void 0===window||window.addEventListener("blur",(()=>{n=!1}))}((()=>{this.track(a.FOCUSED)}))}postMessage(e,n="*"){return new Promise(((i,t)=>{const o=new MessageChannel,s={payload:e,id:this.identifier};o.port1.onmessage=({data:e})=>{o.port1.close();const{error:n,data:s}=e;n?t(new Error(n)):i(s)},this.window.postMessage(s,n,[o.port2])}))}execute(e,...n){if(!this.initialized)throw new Error("SDK is not initialized");if(!d.includes(e))throw new Error("Invalid command");return this.postMessage({command:e,args:n[0],type:t.COMMAND})}track(e,n="*"){const i={payload:{type:t.TRACK,event:e},id:this.identifier};this.window.postMessage(i,n)}listen(e,n){if(!c.includes(e))throw new Error("Invalid event");const i=new MessageChannel,o={payload:{type:t.LISTENER,event:e},id:this.identifier};return i.port1.onmessage=({data:e})=>{e.error&&i.port1.close(),n(e)},this.window.postMessage(o,"*",[i.port2]),()=>{i.port1.close()}}setWindow(e){this.window=e}initialize(i={}){return e(this,void 0,void 0,(function*(){return yield this.postMessage({command:n.INITIALIZE,args:i,type:t.COMMAND}),this.initialized=!0,this}))}},{Command:n,Event:i,Modal:s,ModalStatus:r,Color:o,TrackingEvent:a,MessageType:t})}));
//# sourceMappingURL=index.umd.js.map
